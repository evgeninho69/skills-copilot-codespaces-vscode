<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ï–≠–ö–û –Ω–∞ Flask</title>
    <!-- –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∞–µ–º –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.min.js"></script>
    <!-- –î–æ–±–∞–≤–ª—è–µ–º jQuery –∏ jQuery UI –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <!-- –î–æ–±–∞–≤–ª—è–µ–º Leaflet.Draw –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ø–æ–ª–∏–≥–æ–Ω–æ–≤ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            font-family: Arial, sans-serif; 
            overflow: hidden; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
            height: 100vh;
            width: 100vw;
        }
        
        .map-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 0;
            resize: none;
            overflow: hidden;
        }

        #map { 
            height: 100%;
            width: 100%;
            border: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        h1 {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            margin: 0;
            padding: 5px 15px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 5px;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .leaflet-control-layers {
            font-family: Arial, sans-serif;
            font-size: 14px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: none;
        }
        .leaflet-control-layers-toggle {
            width: 40px;
            height: 40px;
            background-size: 20px 20px;
            border-radius: 4px;
            background-color: white;
            transition: all 0.3s ease;
        }
        .leaflet-control-layers-toggle:hover {
            background-color: #f4f4f4;
        }
        .leaflet-control-layers-list {
            padding: 6px;
        }
        .leaflet-control-layers label {
            margin-bottom: 5px;
        }
        .leaflet-control-zoom {
            border: none !important;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .leaflet-control-zoom-in,
        .leaflet-control-zoom-out {
            width: 40px !important;
            height: 40px !important;
            line-height: 40px !important;
            border-radius: 4px !important;
            background-color: white !important;
            color: #333 !important;
            font-size: 18px !important;
            transition: all 0.3s ease;
        }
        .leaflet-control-zoom-in:hover,
        .leaflet-control-zoom-out:hover {
            background-color: #f4f4f4 !important;
            color: #000 !important;
        }
        .leaflet-control-scale {
            font-family: Arial, sans-serif;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .coordinate-display {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: none;
        }
        .search-control.leaflet-control {
            margin-right: 10px;
            margin-top: 50px;
        }

        .search-button {
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .search-button:hover {
            background-color: #f4f4f4;
            transform: scale(1.05);
        }

        .search-container {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 10px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none;
            width: 300px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .search-container.active {
            opacity: 1;
            transform: translateY(0);
            display: block;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: none;
            border-bottom: 1px solid #eee;
            border-radius: 4px 4px 0 0;
            font-size: 14px;
            box-sizing: border-box;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-bottom-color: #0078A8;
            box-shadow: 0 1px 0 0 #0078A8;
        }

        .search-results {
            max-height: 300px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: #0078A8 #f4f4f4;
        }

        .search-results::-webkit-scrollbar {
            width: 6px;
        }

        .search-results::-webkit-scrollbar-track {
            background: #f4f4f4;
        }

        .search-results::-webkit-scrollbar-thumb {
            background-color: #0078A8;
            border-radius: 3px;
        }

        .search-result-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: all 0.2s ease;
            font-size: 13px;
            color: #333;
        }

        .search-result-item:hover {
            background: #f8f8f8;
            padding-left: 15px;
        }

        .search-result-item:last-child {
            border-bottom: none;
            border-radius: 0 0 4px 4px;
        }

        /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–µ—Å–∞–π–∑–∏–Ω–≥–∞, —Ç–∞–∫ –∫–∞–∫ –∫–∞—Ä—Ç–∞ —Ç–µ–ø–µ—Ä—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
        .map-container::after {
            content: none;
        }

        /* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        .fullscreen-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            border: none;
            border-radius: 4px;
            width: 40px;
            height: 40px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ */
        .cadastral-search {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .cadastral-search input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 250px;
            font-size: 14px;
        }
        
        .cadastral-search button {
            padding: 8px 15px;
            background: #0078A8;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .cadastral-search button:hover {
            background: #005b80;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ */
        .cadastral-tooltip {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .cadastral-popup {
            max-width: 350px;
            max-height: 400px;
        }

        .cadastral-popup-content {
            font-size: 13px;
            overflow-y: auto;
            max-height: 300px;
        }

        .cadastral-popup-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #0078A8;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .cadastral-popup-row {
            display: flex;
            margin-bottom: 5px;
        }

        .cadastral-popup-label {
            font-weight: bold;
            min-width: 140px;
            color: #555;
        }

        .cadastral-popup-value {
            flex: 1;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –Ω–∞ —É—á–∞—Å—Ç–∫–µ */
        .cadastral-label {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid #000;
            padding: 2px 4px;
            font-size: 11px;
            font-weight: bold;
            color: #000;
            text-align: center;
            border-radius: 3px;
            white-space: nowrap;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        /* –£–¥–∞–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç—É—Ä–∞–º–∏ */
        .cadastral-tools {
            position: absolute;
            top: 110px;
            left: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            padding: 5px;
        }

        .cadastral-tools button {
            display: block;
            width: 100%;
            padding: 8px 10px;
            margin-bottom: 5px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-size: 13px;
        }

        .cadastral-tools button:last-child {
            margin-bottom: 0;
        }

        .cadastral-tools button:hover {
            background: #f4f4f4;
            border-color: #bbb;
        }

        .cadastral-tools button.active {
            background: #e6f2f7;
            border-color: #0078A8;
            color: #0078A8;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            display: none;
            text-align: center;
        }

        .loading-indicator .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0078A8;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∞ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö —Å–ª–æ–µ–≤ */
        .cadastral-layers-control {
            position: absolute;
            top: 10px;
            right: 50px;
            z-index: 1000;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            padding: 10px;
            width: 280px;
            font-size: 14px;
            cursor: move; /* –£–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            transition: box-shadow 0.2s ease;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –ø–∞–Ω–µ–ª–∏ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è */
        .cadastral-layers-control.dragging {
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            opacity: 0.9;
            z-index: 1100; /* –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º z-index –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è */
        }

        .cadastral-layers-title {
            font-weight: bold;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            color: #333;
            cursor: move; /* –£–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
            position: relative;
            padding: 5px;
            margin: -5px -5px 8px -5px;
            user-select: none; /* –ó–∞–ø—Ä–µ—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ */
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–∏—è –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
        .cadastral-layers-title:hover {
            background-color: #f9f9f9;
            border-radius: 4px 4px 0 0;
        }
        
        /* –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º –∑–∞–≥–æ–ª–æ–≤–∫–µ (–Ω–∞–∂–∞—Ç–∏–∏) */
        .cadastral-layers-title:active {
            background-color: #f5f5f5;
            cursor: grabbing;
        }

        .cadastral-layer-item {
            margin-bottom: 6px;
            display: flex;
            align-items: center;
        }

        .cadastral-layer-item input {
            margin-right: 8px;
        }

        .cadastral-layer-item label {
            cursor: pointer;
            flex: 1;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏—Ö—Å—è –æ–±—ä–µ–∫—Ç–æ–≤ */
        .overlapping-objects-popup {
            position: absolute;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 1000;
            padding: 10px;
            min-width: 250px;
        }

        .overlapping-objects-title {
            font-weight: bold;
            padding-bottom: 8px;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            color: #0078A8;
        }

        .overlapping-object-item {
            padding: 8px 10px;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
            transition: all 0.2s ease;
        }

        .overlapping-object-item:hover {
            background: #f0f8ff;
            padding-left: 15px;
        }

        .overlapping-object-cadnum {
            font-weight: bold;
        }

        .overlapping-object-type {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        .overlapping-object-highlight {
            animation: pulse-highlight 1.5s ease-in-out infinite;
        }

        @keyframes pulse-highlight {
            0% { opacity: 0.8; }
            50% { opacity: 0.4; }
            100% { opacity: 0.8; }
        }
    </style>
</head>
<body>
    <div class="map-container">
    <h1>–ï–¥–∏–Ω–∞—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞</h1>
    
        <!-- –§–æ—Ä–º–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ -->
        <div class="cadastral-search">
            <input type="text" id="cadastral-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä..." />
            <button id="cadastral-search-btn">–ù–∞–π—Ç–∏ –æ–±—ä–µ–∫—Ç</button>
    </div>
        
        <!-- –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç—É—Ä–∞–º–∏ -->
        <div class="cadastral-tools">
            <button id="draw-polygon-btn" title="–í—ã–¥–µ–ª–∏—Ç–µ –æ–±–ª–∞—Å—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã">–ü–æ–∏—Å–∫ –ø–æ –æ–±–ª–∞—Å—Ç–∏</button>
            <button id="clear-polygon-btn" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏">–û—á–∏—Å—Ç–∏—Ç—å –æ–±–ª–∞—Å—Ç–∏</button>
        </div>
        
        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="loading-indicator">
            <div class="spinner"></div>
            <div>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤...</div>
        </div>

        <div id="map"></div>
    <div id="coordinate-display" class="coordinate-display"></div>
    </div>

    <script>
        // –ó–∞–º–µ–Ω–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –Ω–∞ –æ–¥–Ω—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é
        const mapCrs = L.CRS.EPSG3857; // Web Mercator

        // –î–æ–±–∞–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        const crsInfo = {
            name: 'Web Mercator (EPSG:3857)',
            description: '–ü—Ä–æ–µ–∫—Ü–∏—è –ú–µ—Ä–∫–∞—Ç–æ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –≤ –≤–µ–±-–∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏–∏',
            params: {
                datum: 'WGS 84',
                proj: '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs',
                bounds: [-20026376.39, -20048966.10, 20026376.39, 20048966.10],
                units: '–º–µ—Ç—Ä—ã'
            }
        };

        // –û–±–Ω–æ–≤–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–∞—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        const layersCrsInfo = {
            "OpenStreetMap": {
                name: 'EPSG:3857',
                description: 'Web Mercator (–°—Ñ–µ—Ä–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è –ú–µ—Ä–∫–∞—Ç–æ—Ä–∞)',
                details: {
                    datum: 'WGS 84',
                    proj: '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs',
                    bounds: [-20026376.39, -20048966.10, 20026376.39, 20048966.10],
                    units: '–º–µ—Ç—Ä—ã',
                    usage: `
                        <strong>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:</strong><br>
                        ‚Ä¢ –í–µ–±-–∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—è<br>
                        ‚Ä¢ –û–Ω–ª–∞–π–Ω-–∫–∞—Ä—Ç—ã<br>
                        ‚Ä¢ –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã<br><br>
                        <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</strong><br>
                        ‚Ä¢ –ö–æ–Ω—Ñ–æ—Ä–º–Ω–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —É–≥–ª—ã)<br>
                        ‚Ä¢ –ò—Å–∫–∞–∂–∞–µ—Ç –ø–ª–æ—â–∞–¥–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –≤—ã—Å–æ–∫–∏—Ö —à–∏—Ä–æ—Ç–∞—Ö<br>
                        ‚Ä¢ –≠–∫–≤–∞—Ç–æ—Ä —è–≤–ª—è–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø–∞—Ä–∞–ª–ª–µ–ª—å—é<br>
                        ‚Ä¢ –ú–∞—Å—à—Ç–∞–± –ø–æ—Å—Ç–æ—è–Ω–µ–Ω –≤–¥–æ–ª—å –º–µ—Ä–∏–¥–∏–∞–Ω–æ–≤<br><br>
                        <strong>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–µ–∫—Ü–∏–∏:</strong><br>
                        ‚Ä¢ –ë–æ–ª—å—à–∞—è –ø–æ–ª—É–æ—Å—å (a): 6378137.0 –º<br>
                        ‚Ä¢ –ú–∞–ª–∞—è –ø–æ–ª—É–æ—Å—å (b): 6378137.0 –º<br>
                        ‚Ä¢ –ú–∞—Å—à—Ç–∞–±–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (k): 1.0<br>
                        ‚Ä¢ –ù–∞—á–∞–ª–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: 0¬∞ —à., 0¬∞ –¥.<br><br>
                        <strong>–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:</strong><br>
                        1. –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ ‚Üí –ü—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ:<br>
                        x = R √ó Œª<br>
                        y = R √ó ln[tan(œÄ/4 + œÜ/2)]<br>
                        –≥–¥–µ R = 6378137 –º, Œª - –¥–æ–ª–≥–æ—Ç–∞ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö, œÜ - —à–∏—Ä–æ—Ç–∞ –≤ —Ä–∞–¥–∏–∞–Ω–∞—Ö<br><br>
                        2. –ü—Ä–æ–µ–∫—Ü–∏–æ–Ω–Ω—ã–µ ‚Üí –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ:<br>
                        Œª = x/R<br>
                        œÜ = 2 √ó atan(e^(y/R)) - œÄ/2<br><br>
                        <strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</strong><br>
                        ‚Ä¢ –®–∏—Ä–æ—Ç–∞: –æ—Ç -85.06¬∞ –¥–æ +85.06¬∞<br>
                        ‚Ä¢ –î–æ–ª–≥–æ—Ç–∞: –æ—Ç -180¬∞ –¥–æ +180¬∞<br><br>
                        <strong>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:</strong><br>
                        ‚Ä¢ –î–ª—è –≤–µ–±-–∫–∞—Ä—Ç –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ç–∞–π–ª—ã<br>
                        ‚Ä¢ –î–ª—è GIS-–∞–Ω–∞–ª–∏–∑–∞ —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è –ø–ª–æ—â–∞–¥–µ–π<br>
                        ‚Ä¢ –î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–æ—Ä–º—É–ª—ã –ø–µ—Ä–µ—Å—á–µ—Ç–∞
                    `
                }
            },
            "Google –°–ø—É—Ç–Ω–∏–∫": {
                name: 'EPSG:3857',
                description: 'Web Mercator (Google Maps)',
                details: {
                    datum: 'WGS 84',
                    proj: '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs',
                    bounds: [-20026376.39, -20048966.10, 20026376.39, 20048966.10],
                    units: '–º–µ—Ç—Ä—ã',
                    usage: `
                        <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–ª–æ—è:</strong><br>
                        ‚Ä¢ –°–ø—É—Ç–Ω–∏–∫–æ–≤—ã–µ —Å–Ω–∏–º–∫–∏ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è<br>
                        ‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö<br>
                        ‚Ä¢ –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ<br><br>
                        <strong>–°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:</strong><br>
                        ‚Ä¢ –ò–¥–µ–Ω—Ç–∏—á–Ω–∞ OSM (EPSG:3857)<br>
                        ‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –≤–µ–±-–∫–∞—Ä—Ç<br>
                        ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∞–π–ª–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É<br><br>
                        <strong>–¢–æ—á–Ω–æ—Å—Ç—å –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ:</strong><br>
                        ‚Ä¢ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ: –¥–æ 0.1 –º/–ø–∏–∫—Å–µ–ª—å<br>
                        ‚Ä¢ –¢–æ—á–Ω–æ—Å—Ç—å –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: 1-5 –º<br>
                        ‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º<br><br>
                        <strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ì–ò–°:</strong><br>
                        ‚Ä¢ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ü–∏—Ñ—Ä–æ–≤–∫–∏<br>
                        ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–≤–µ—Ä–ª–µ–∏ –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —Å–ª–æ–∏<br>
                        ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –¥—Ä—É–≥–∏–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
                    `
                }
            },
            "Google –ì–∏–±—Ä–∏–¥": {
                name: 'EPSG:3857',
                description: 'Web Mercator (Google Maps Hybrid)',
                details: {
                    datum: 'WGS 84',
                    proj: '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs',
                    bounds: [-20026376.39, -20048966.10, 20026376.39, 20048966.10],
                    units: '–º–µ—Ç—Ä—ã',
                    usage: `
                        <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Å–ª–æ—è:</strong><br>
                        ‚Ä¢ –ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã—Ö —Å–Ω–∏–º–∫–æ–≤ –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö<br>
                        ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π<br>
                        ‚Ä¢ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö<br><br>
                        <strong>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:</strong><br>
                        ‚Ä¢ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ<br>
                        ‚Ä¢ –ì—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑<br>
                        ‚Ä¢ –ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ —Ä–∞–±–æ—Ç—ã<br><br>
                        <strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong><br>
                        ‚Ä¢ –°–æ—á–µ—Ç–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–Ω–∏–º–∫–æ–≤ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞—Ä—Ç—ã<br>
                        ‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –≤ –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å—Ä–µ–¥–µ<br>
                        ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
                    `
                }
            },
            "–Ø–Ω–¥–µ–∫—Å": {
                name: 'EPSG:3857',
                description: 'Web Mercator (–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã)',
                details: {
                    datum: 'WGS 84',
                    proj: '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs',
                    bounds: [-20026376.39, -20048966.10, 20026376.39, 20048966.10],
                    units: '–º–µ—Ç—Ä—ã',
                    usage: `
                        <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç:</strong><br>
                        ‚Ä¢ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –†–æ—Å—Å–∏–∏ –∏ –°–ù–ì<br>
                        ‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è<br>
                        ‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è<br><br>
                        <strong>–°–∏—Å—Ç–µ–º–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:</strong><br>
                        ‚Ä¢ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è Web Mercator<br>
                        ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç<br>
                        ‚Ä¢ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏<br><br>
                        <strong>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:</strong><br>
                        ‚Ä¢ –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤<br>
                        ‚Ä¢ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è<br>
                        ‚Ä¢ –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
                    `
                }
            },
            "–Ø–Ω–¥–µ–∫—Å –°–ø—É—Ç–Ω–∏–∫": {
                name: 'EPSG:3857',
                description: 'Web Mercator (–Ø–Ω–¥–µ–∫—Å.–°–ø—É—Ç–Ω–∏–∫)',
                details: {
                    datum: 'WGS 84',
                    proj: '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs',
                    bounds: [-20026376.39, -20048966.10, 20026376.39, 20048966.10],
                    units: '–º–µ—Ç—Ä—ã',
                    usage: `
                        <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–ø—É—Ç–Ω–∏–∫–æ–≤–æ–≥–æ —Å–ª–æ—è:</strong><br>
                        ‚Ä¢ –í—ã—Å–æ–∫–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–§<br>
                        ‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∏–º–∫–æ–≤<br>
                        ‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö —É—Å–ª–æ–≤–∏–π<br><br>
                        <strong>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong><br>
                        ‚Ä¢ –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–æ 0.5 –º/–ø–∏–∫—Å–µ–ª—å –≤ –∫—Ä—É–ø–Ω—ã—Ö –≥–æ—Ä–æ–¥–∞—Ö<br>
                        ‚Ä¢ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è<br>
                        ‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≥–µ–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π<br><br>
                        <strong>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:</strong><br>
                        ‚Ä¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π<br>
                        ‚Ä¢ –ì—Ä–∞–¥–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑<br>
                        ‚Ä¢ –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å<br><br>
                        <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong><br>
                        ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ñ—Ñ–ª–∞–π–Ω-–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è<br>
                        ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≥–µ–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏<br>
                        ‚Ä¢ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏
                    `
                }
            },
            "–Ø–Ω–¥–µ–∫—Å –ì–∏–±—Ä–∏–¥": {
                name: 'EPSG:3857',
                description: 'Web Mercator (–Ø–Ω–¥–µ–∫—Å.–ì–∏–±—Ä–∏–¥)',
                details: {
                    datum: 'WGS 84',
                    proj: '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs',
                    bounds: [-20026376.39, -20048966.10, 20026376.39, 20048966.10],
                    units: '–º–µ—Ç—Ä—ã',
                    usage: `
                        <strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Å–ª–æ—è:</strong><br>
                        ‚Ä¢ –°–ø—É—Ç–Ω–∏–∫–æ–≤—ã–µ —Å–Ω–∏–º–∫–∏ –∫–∞–∫ –±–∞–∑–æ–≤—ã–π —Å–ª–æ–π<br>
                        ‚Ä¢ –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–≤–µ—Ä—Ö —Å–Ω–∏–º–∫–æ–≤<br>
                        ‚Ä¢ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –ø–æ–¥–ø–∏—Å–∏ –∏ POI<br><br>
                        <strong>–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:</strong><br>
                        ‚Ä¢ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö<br>
                        ‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–∞—Ä—Ç—ã<br>
                        ‚Ä¢ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö<br><br>
                        <strong>–û–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:</strong><br>
                        ‚Ä¢ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∞<br>
                        ‚Ä¢ –¢–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∞–ª—å–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ<br>
                        ‚Ä¢ –ì–µ–æ–º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è<br><br>
                        <strong>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</strong><br>
                        ‚Ä¢ –ú–Ω–æ–≥–æ—Å–ª–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞<br>
                        ‚Ä¢ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö<br>
                        ‚Ä¢ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
                    `
                }
            },
            "–¢–æ–ø–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è": {
                name: 'EPSG:3857',
                description: 'Web Mercator (OpenTopoMap)',
                details: {
                    datum: 'WGS 84',
                    proj: '+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs',
                    bounds: [-20026376.39, -20048966.10, 20026376.39, 20048966.10],
                    units: '–º–µ—Ç—Ä—ã',
                    usage: `
                        <strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ç–æ–ø–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –∫–∞—Ä—Ç—ã:</strong><br>
                        ‚Ä¢ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–ª—å–µ—Ñ–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏<br>
                        ‚Ä¢ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∏ –æ—Ç–º–µ—Ç–∫–∏ –≤—ã—Å–æ—Ç<br>
                        ‚Ä¢ –ü—Ä–∏—Ä–æ–¥–Ω—ã–µ –∏ –∞–Ω—Ç—Ä–æ–ø–æ–≥–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã<br><br>
                        <strong>–≠–ª–µ–º–µ–Ω—Ç—ã —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è:</strong><br>
                        ‚Ä¢ –†–µ–ª—å–µ—Ñ –∏ –≥–∏–¥—Ä–æ–≥—Ä–∞—Ñ–∏—è<br>
                        ‚Ä¢ –†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ–∫—Ä–æ–≤<br>
                        ‚Ä¢ –ù–∞—Å–µ–ª–µ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –∏ –¥–æ—Ä–æ–≥–∏<br>
                        ‚Ä¢ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã<br><br>
                        <strong>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:</strong><br>
                        ‚Ä¢ –¢—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è<br>
                        ‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤<br>
                        ‚Ä¢ –ê–Ω–∞–ª–∏–∑ —Ä–µ–ª—å–µ—Ñ–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏<br><br>
                        <strong>–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</strong><br>
                        ‚Ä¢ –ì–µ–Ω–µ—Ä–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–∞—Å—à—Ç–∞–±–∞<br>
                        ‚Ä¢ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã—Å–æ—Ç<br>
                        ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–ª–∏–Ω–∏–π —Ä–µ–ª—å–µ—Ñ–∞
                    `
                }
            }
        };

        let map, baseLayers;

        function initMap() {
            // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
            map = L.map('map', {
                crs: mapCrs,
                center: [56.8587, 35.9176], // –¶–µ–Ω—Ç—Ä –¢–≤–µ—Ä–∏
                zoom: 10,
                maxZoom: 23,
                zoomControl: true
            });

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ —Å–ª–æ–∏
            baseLayers = {
                "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 23,
                    maxNativeZoom: 19,
                    tileSize: 256,
                    zoomOffset: 0,
                    errorTileUrl: '',
                    attribution: '¬© OpenStreetMap contributors'
                }),
                "Google –°–ø—É—Ç–Ω–∏–∫": L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                    maxZoom: 23,
                    maxNativeZoom: 20,
                    tileSize: 256,
                    zoomOffset: 0,
                    errorTileUrl: '',
                    attribution: '¬© Google'
                }),
                "Google –ì–∏–±—Ä–∏–¥": L.tileLayer('https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
                    maxZoom: 23,
                    maxNativeZoom: 20,
                    tileSize: 256,
                    zoomOffset: 0,
                    errorTileUrl: '',
                    attribution: '¬© Google'
                }),
                "–Ø–Ω–¥–µ–∫—Å": L.tileLayer('https://core-renderer-tiles.maps.yandex.net/tiles?l=map&x={x}&y={y}&z={z}', {
                    maxZoom: 23,
                    maxNativeZoom: 19,
                    tileSize: 256,
                    zoomOffset: 0,
                    errorTileUrl: '',
                    attribution: '¬© –Ø–Ω–¥–µ–∫—Å'
                }),
                "–Ø–Ω–¥–µ–∫—Å –°–ø—É—Ç–Ω–∏–∫": L.tileLayer('https://core-sat.maps.yandex.net/tiles?l=sat&x={x}&y={y}&z={z}', {
                    maxZoom: 23,
                    maxNativeZoom: 19,
                    tileSize: 256,
                    zoomOffset: 0,
                    errorTileUrl: '',
                    attribution: '¬© –Ø–Ω–¥–µ–∫—Å'
                }),
                "–Ø–Ω–¥–µ–∫—Å –ì–∏–±—Ä–∏–¥": L.layerGroup([
                    L.tileLayer('https://core-sat.maps.yandex.net/tiles?l=sat&x={x}&y={y}&z={z}', {
                        maxZoom: 23,
                        maxNativeZoom: 19,
                        tileSize: 256,
                        zoomOffset: 0,
                        errorTileUrl: '',
                        attribution: '¬© –Ø–Ω–¥–µ–∫—Å'
                    }),
                    L.tileLayer('https://core-renderer-tiles.maps.yandex.net/tiles?l=skl&x={x}&y={y}&z={z}', {
                        maxZoom: 23,
                        maxNativeZoom: 19,
                        tileSize: 256,
                        zoomOffset: 0,
                        errorTileUrl: '',
                        attribution: '¬© –Ø–Ω–¥–µ–∫—Å'
                    })
                ]),
                "–¢–æ–ø–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è": L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                    maxZoom: 23,
                    maxNativeZoom: 17,
                    tileSize: 256,
                    zoomOffset: 0,
                    errorTileUrl: '',
                    attribution: '¬© OpenTopoMap'
                })
            };

            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ª–æ–π
            baseLayers["OpenStreetMap"].addTo(map);

            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Å—à—Ç–∞–±
            L.control.scale({
                imperial: false,
                metric: true
            }).addTo(map);

            // –û–±–Ω–æ–≤–∏–º –∫–æ–Ω—Ç—Ä–æ–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ CRS
            const crsInfoControl = L.control({position: 'bottomleft'});
            crsInfoControl.onAdd = function() {
                const div = L.DomUtil.create('div', 'leaflet-control-layers crs-info');
                div.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
                div.style.padding = '3px 5px';
                div.style.borderRadius = '3px';
                div.style.fontSize = '10px';
                div.style.maxWidth = '150px';
                div.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
                div.style.cursor = 'pointer';
                div.style.color = '#666';

                // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∫–∞—Ä—Ç—ã –ø—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ —Å –∫–æ–Ω—Ç—Ä–æ–ª–æ–º
                L.DomEvent.disableClickPropagation(div);
                L.DomEvent.disableScrollPropagation(div);

                // –°–æ–∑–¥–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ
                const popup = L.popup({
                    className: 'crs-popup',
                    closeButton: true,
                    closeOnClick: true,
                    autoClose: true,
                    offset: [0, -5]
                });

                function updateCrsInfo() {
                    let activeLayer = 'OpenStreetMap';
                    Object.entries(baseLayers).forEach(([name, layer]) => {
                        if (map.hasLayer(layer)) activeLayer = name;
                    });
                    div.innerHTML = `${layersCrsInfo[activeLayer].name}`;

                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                    div.onclick = function(e) {
                        e.stopPropagation();
                        const info = layersCrsInfo[activeLayer];
                        const content = `
                            <div style="font-size: 12px; max-width: 400px; max-height: 400px; overflow-y: auto;">
                                <strong>${info.name}</strong><br>
                                ${info.description}<br><br>
                                <strong>–ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</strong><br>
                                <small>
                                    ‚Ä¢ –î–∞—Ç—É–º: ${info.details.datum}<br>
                                    ‚Ä¢ –ï–¥–∏–Ω–∏—Ü—ã: ${info.details.units}<br>
                                    ‚Ä¢ Proj4: <span style="font-size: 10px; word-break: break-all;">${info.details.proj}</span>
                                </small><br><br>
                                <div style="font-size: 11px;">
                                    ${info.details.usage}
                                </div>
                            </div>
                        `;

                        // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø–æ–ø–∞–ø –Ω–∞–¥ –∫–æ–Ω—Ç—Ä–æ–ª–æ–º
                        const controlPoint = map.containerPointToLatLng([
                            div.getBoundingClientRect().left + div.offsetWidth/2,
                            div.getBoundingClientRect().top
                        ]);
                        
                        popup.setContent(content)
                            .setLatLng(controlPoint)
                            .openOn(map);
                    };
                }

                updateCrsInfo();
                map.on('baselayerchange', updateCrsInfo);
                return div;
            };
            crsInfoControl.addTo(map);

            // –°–æ–∑–¥–∞–¥–∏–º –Ω–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª –¥–ª—è –ø–æ–∏—Å–∫–∞
            const SearchControl = L.Control.extend({
                options: {
                    position: 'topright'
                },

                onAdd: function(map) {
                    const container = L.DomUtil.create('div', 'leaflet-control search-control');
                    
                    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É —Å –∏–∫–æ–Ω–∫–æ–π –ø–æ–∏—Å–∫–∞
                    const button = L.DomUtil.create('button', 'search-button', container);
                    button.innerHTML = 'üîç';
                    
                    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞
                    const searchContainer = L.DomUtil.create('div', 'search-container', container);
                    const searchInput = L.DomUtil.create('input', 'search-input', searchContainer);
                    searchInput.type = 'text';
                    searchInput.placeholder = '–ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É...';
                    const searchResults = L.DomUtil.create('div', 'search-results', searchContainer);

                    let searchTimeout;
                    let searchMarker;

                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∫–∞—Ä—Ç—ã
                    L.DomEvent.disableClickPropagation(container);
                    L.DomEvent.disableScrollPropagation(container);

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ –ø–æ–∏—Å–∫–∞
                    button.onclick = function(e) {
                        e.preventDefault();
                        if (searchContainer.style.display === 'none') {
                            searchContainer.style.display = 'block';
                            setTimeout(() => {
                                searchContainer.classList.add('active');
                                searchInput.focus();
                            }, 10);
                        } else {
                            searchContainer.classList.remove('active');
                            setTimeout(() => {
                                searchContainer.style.display = 'none';
                            }, 300);
                        }
                    };

                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞
                    searchInput.addEventListener('input', function() {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            const query = this.value;
                            if (query.length >= 3) {
                                // –ò—Å–ø–æ–ª—å–∑—É–µ–º Nominatim –¥–ª—è –ø–æ–∏—Å–∫–∞
                                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&countrycodes=ru&limit=10`)
                                    .then(response => response.json())
                                    .then(data => {
                                        searchResults.innerHTML = '';
                                        data.forEach(result => {
                                            const resultItem = L.DomUtil.create('div', 'search-result-item', searchResults);
                                            resultItem.textContent = result.display_name;
                                            resultItem.onclick = () => {
                                                if (searchMarker) {
                                                    map.removeLayer(searchMarker);
                                                }
                                                const lat = parseFloat(result.lat);
                                                const lon = parseFloat(result.lon);
                                                searchMarker = L.marker([lat, lon]).addTo(map);
                                                map.setView([lat, lon], 16);
                                                searchMarker.bindPopup(result.display_name).openPopup();
                                                searchContainer.classList.remove('active');
                                                searchInput.value = result.display_name;
                                            };
                                        });
                                    })
                                    .catch(console.error);
                            }
                        }, 300);
                    });

                    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
                    document.addEventListener('click', function(e) {
                        if (!container.contains(e.target)) {
                            searchContainer.classList.remove('active');
                            setTimeout(() => {
                                searchContainer.style.display = 'none';
                            }, 300);
                        }
                    });

                    return container;
                }
            });

            // –í —Ñ—É–Ω–∫—Ü–∏–∏ initMap –¥–æ–±–∞–≤–ª—è–µ–º:
            map.addControl(new SearchControl());

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ –¥–ª—è –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
            let cadastralLayers = {
                "–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏": L.layerGroup().addTo(map),
                "–û–±—ä–µ–∫—Ç—ã –∫–∞–ø–∏—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞": L.layerGroup().addTo(map),
                "–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã": L.layerGroup().addTo(map)
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ø–æ–ª–∏–≥–æ–Ω–æ–≤ –ø–æ–∏—Å–∫–∞
            let drawnItems = new L.FeatureGroup();
            map.addLayer(drawnItems);
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è
            let drawControl = new L.Control.Draw({
                draw: {
                    polyline: false,
                    rectangle: true,
                    circle: false,
                    circlemarker: false,
                    marker: false,
                    polygon: {
                        allowIntersection: false,
                        drawError: {
                            color: '#e1e100',
                            message: '<strong>–û—à–∏–±–∫–∞:</strong> –ø–æ–ª–∏–≥–æ–Ω—ã –Ω–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è!'
                        },
                        shapeOptions: {
                            color: '#0078A8',
                            weight: 2
                        }
                    }
                },
                edit: {
                    featureGroup: drawnItems,
                    remove: true
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Ä–∏—Å–æ–≤–∞–Ω–∏—è
            map.on(L.Draw.Event.CREATED, function (event) {
                const layer = event.layer;
                drawnItems.addLayer(layer);
                
                // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ–ª–∏–≥–æ–Ω –∏–ª–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –≤ —ç—Ç–æ–π –æ–±–ª–∞—Å—Ç–∏
                if (event.layerType === 'polygon' || event.layerType === 'rectangle') {
                    searchObjectsInArea(layer);
                }
            });
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
            function searchObjectsInArea(layer) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                document.querySelector('.loading-indicator').style.display = 'block';
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª–∏–≥–æ–Ω–∞
                const polygon = layer.toGeoJSON();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–Ω—Å–æ–ª—å
                console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å —Å –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π:', JSON.stringify(polygon.geometry));
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                fetch('/api/cadastral/search_in_contour', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        geometry: polygon.geometry
                    })
                })
                .then(response => {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
                    if (!response.ok) {
                        // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞
                        return response.json().then(errorData => {
                            throw new Error(errorData.error || `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                        }).catch(err => {
                            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON —Å –æ—à–∏–±–∫–æ–π
                            if (err instanceof SyntaxError) {
                                throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                            }
                            throw err;
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                    document.querySelector('.loading-indicator').style.display = 'none';
                    
                    if (data.features && data.features.length > 0) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –Ω–∞ –∫–∞—Ä—Ç—É
                        data.features.forEach(feature => {
                            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞ (–ó–£ –∏–ª–∏ –û–ö–°)
                            const isLandParcel = feature.properties.land_record_type === '–ó–µ–º–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫';
                            addCadastralObject({
                                type: 'Feature',
                                properties: feature.properties,
                                geometry: feature.geometry,
                                objectType: isLandParcel ? '–ó–µ–º–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫' : '–û–±—ä–µ–∫—Ç –∫–∞–ø–∏—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞'
                            }, isLandParcel);
                        });
                        
                        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                        alert(`–ù–∞–π–¥–µ–Ω–æ –æ–±—ä–µ–∫—Ç–æ–≤: ${data.features.length}`);
                    } else {
                        alert('–í –≤—ã–±—Ä–∞–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤');
                    }
                })
                .catch(error => {
                    // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                    document.querySelector('.loading-indicator').style.display = 'none';
                    
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –æ–±—ä–µ–∫—Ç–æ–≤:', error);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
                    if (error.message.includes('TooBigContour')) {
                        alert('–í—ã–±—Ä–∞–Ω–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω—å—à—É—é –æ–±–ª–∞—Å—Ç—å.');
                    } else {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
                        alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –æ–±—ä–µ–∫—Ç–æ–≤: ${error.message}`);
                    }
                });
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω—Ç—É—Ä–∞–º–∏
            document.getElementById('draw-polygon-btn').addEventListener('click', function() {
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Ä–∏—Å–æ–≤–∞–Ω–∏—è –ø–æ–ª–∏–≥–æ–Ω–∞
                new L.Draw.Polygon(map, drawControl.options.draw.polygon).enable();
            });
            
            document.getElementById('clear-polygon-btn').addEventListener('click', function() {
                // –û—á–∏—â–∞–µ–º –≤—Å–µ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª–∏–≥–æ–Ω—ã
                drawnItems.clearLayers();
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –¢–û–õ–¨–ö–û –ë–ê–ó–û–í–´–ï —Å–ª–æ–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª (—É–¥–∞–ª—è–µ–º –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–∞)
            // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–Ω—Ç—Ä–æ–ª —Å–ª–æ–µ–≤, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏–ª—Å—è –≤ –∫—Ä–∞—Å–Ω–æ–º –∫–≤–∞–¥—Ä–∞—Ç–µ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ
            L.control.layers(baseLayers, null, {
                position: 'topright',
                collapsed: true
            }).addTo(map);

            // –°–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª –¥–ª—è –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö —Å–ª–æ–µ–≤
            const cadastralLayersControl = L.Control.extend({
                options: {
                    position: 'topright'
                },

                onAdd: function() {
                    const container = L.DomUtil.create('div', 'cadastral-layers-control');
                    container.innerHTML = `
                        <div class="cadastral-layers-title">–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ —Å–ª–æ–∏</div>
                        <div class="cadastral-layer-items">
                            <div class="cadastral-layer-item">
                                <input type="checkbox" id="layer-land-parcels" checked>
                                <label for="layer-land-parcels">–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏</label>
                            </div>
                            <div class="cadastral-layer-item">
                                <input type="checkbox" id="layer-buildings" checked>
                                <label for="layer-buildings">–û–±—ä–µ–∫—Ç—ã –∫–∞–ø–∏—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞</label>
                            </div>
                            <div class="cadastral-layer-item">
                                <input type="checkbox" id="layer-cadastral-all" checked>
                                <label for="layer-cadastral-all">–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã</label>
                            </div>
                        </div>
                    `;

                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ—Ö–≤–∞—Ç —Å–æ–±—ã—Ç–∏–π –∫–∞—Ä—Ç–æ–π
                    L.DomEvent.disableClickPropagation(container);
                    L.DomEvent.disableScrollPropagation(container);

                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤
                    const landParcelsCheckbox = container.querySelector('#layer-land-parcels');
                    const buildingsCheckbox = container.querySelector('#layer-buildings');
                    const cadastralAllCheckbox = container.querySelector('#layer-cadastral-all');

                    landParcelsCheckbox.addEventListener('change', function() {
                        if (this.checked) {
                            map.addLayer(cadastralLayers["–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏"]);
                        } else {
                            map.removeLayer(cadastralLayers["–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏"]);
                        }
                    });

                    buildingsCheckbox.addEventListener('change', function() {
                        if (this.checked) {
                            map.addLayer(cadastralLayers["–û–±—ä–µ–∫—Ç—ã –∫–∞–ø–∏—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞"]);
                        } else {
                            map.removeLayer(cadastralLayers["–û–±—ä–µ–∫—Ç—ã –∫–∞–ø–∏—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞"]);
                        }
                    });

                    cadastralAllCheckbox.addEventListener('change', function() {
                        if (this.checked) {
                            map.addLayer(cadastralLayers["–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã"]);
                        } else {
                            map.removeLayer(cadastralLayers["–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã"]);
                        }
                    });

                    // –î–µ–ª–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º—ã–º
                    this._makeControlDraggable(container);

                    return container;
                },

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ–º–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
                _makeControlDraggable: function(container) {
                    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                    const recoverButton = document.createElement('button');
                    recoverButton.textContent = '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–Ω–µ–ª—å —Å–ª–æ–µ–≤';
                    recoverButton.style.position = 'fixed';
                    recoverButton.style.bottom = '10px';
                    recoverButton.style.right = '10px';
                    recoverButton.style.padding = '8px 12px';
                    recoverButton.style.backgroundColor = '#0078A8';
                    recoverButton.style.color = 'white';
                    recoverButton.style.border = 'none';
                    recoverButton.style.borderRadius = '4px';
                    recoverButton.style.zIndex = '2000';
                    recoverButton.style.cursor = 'pointer';
                    recoverButton.style.fontSize = '12px';
                    recoverButton.style.boxShadow = '0 2px 5px rgba(0,0,0,0.3)';
                    document.body.appendChild(recoverButton);
                    
                    // –Ø–≤–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ (—á—Ç–æ–±—ã –æ–Ω–æ –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è localStorage)
                    $(container).css({
                        top: '10px',
                        right: '50px',
                        left: 'auto'
                    });
                    
                    // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ –ø–æ–∑–∏—Ü–∏–∏
                    function resetPosition() {
                        $(container).css({
                            top: '10px',
                            right: '50px',
                            left: 'auto'
                        });
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é
                        try {
                            localStorage.setItem('cadastralLayersPosition', JSON.stringify({
                                top: 10,
                                right: 50,
                                left: null
                            }));
                        } catch (e) {
                            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏:', e);
                        }
                    }
                    
                    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
                    function loadPosition() {
                        try {
                            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
                            const positionStr = localStorage.getItem('cadastralLayersPosition');
                            
                            // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –∏–ª–∏ –æ–Ω–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–∑–∏—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                            if (!positionStr) {
                                resetPosition();
                                return;
                            }
                            
                            const position = JSON.parse(positionStr);
                            
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
                            if (!position || typeof position !== 'object') {
                                resetPosition();
                                return;
                            }
                            
                            // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏
                            if (position.right !== null) {
                                $(container).css({
                                    right: position.right + 'px',
                                    left: 'auto'
                                });
                            } else if (position.left !== null) {
                                $(container).css({
                                    left: position.left + 'px',
                                    right: 'auto'
                                });
                            }
                            
                            if (position.top !== null) {
                                $(container).css('top', position.top + 'px');
                            }
                            
                            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø–∞–Ω–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞
                            setTimeout(function() {
                                const rect = container.getBoundingClientRect();
                                const viewportWidth = window.innerWidth;
                                const viewportHeight = window.innerHeight;
                                
                                // –ï—Å–ª–∏ –ø–∞–Ω–µ–ª—å —É—à–ª–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é
                                if (rect.left > viewportWidth - 50 || 
                                    rect.right < 50 || 
                                    rect.top > viewportHeight - 50 || 
                                    rect.bottom < 0) {
                                    resetPosition();
                                }
                            }, 100);
                        } catch (e) {
                            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–∑–∏—Ü–∏–∏:', e);
                            resetPosition();
                        }
                    }
                    
                    // –û—á–∏—â–∞–µ–º localStorage –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
                    // localStorage.removeItem('cadastralLayersPosition');
                    
                    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏
                    const title = container.querySelector('.cadastral-layers-title');
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é jQuery UI
                    $(container).draggable({
                        handle: '.cadastral-layers-title',  // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∑–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫
                        addClasses: false,                  // –ù–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–ª–∞—Å—Å—ã jQuery UI
                        scroll: false,                      // –û—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–∫—Ä–æ–ª–ª–∏–Ω–≥
                        containment: [
                            -$(container).width() + 50,     // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è (50px –≤–∏–¥–Ω—ã)
                            0,                              // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Ö–Ω—è—è –ø–æ–∑–∏—Ü–∏—è
                            $(window).width() - 50,         // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–∞–≤–∞—è –ø–æ–∑–∏—Ü–∏—è
                            $(window).height() - 50         // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∏–∂–Ω—è—è –ø–æ–∑–∏—Ü–∏—è
                        ],
                        start: function() {
                            $(container).addClass('dragging');
                            
                            // –ï—Å–ª–∏ –ø–∞–Ω–µ–ª—å –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∞ —Å–ø—Ä–∞–≤–∞, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –ª–µ–≤–æ–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                            if ($(container).css('right') !== 'auto') {
                                const rect = container.getBoundingClientRect();
                                $(container).css({
                                    left: rect.left + 'px',
                                    right: 'auto'
                                });
                            }
                        },
                        stop: function() {
                            $(container).removeClass('dragging');
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é
                            try {
                                const rect = container.getBoundingClientRect();
                                localStorage.setItem('cadastralLayersPosition', JSON.stringify({
                                    top: rect.top,
                                    right: null,
                                    left: rect.left
                                }));
                            } catch (e) {
                                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏:', e);
                            }
                        }
                    });
                    
                    // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–æ–∑–∏—Ü–∏–∏
                    $(title).dblclick(function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        resetPosition();
                    });
                    
                    // –ö–Ω–æ–ø–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
                    $(recoverButton).click(resetPosition);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
                    $(window).resize(function() {
                        const rect = container.getBoundingClientRect();
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º containment –¥–ª—è draggable
                        $(container).draggable('option', 'containment', [
                            -$(container).width() + 50,
                            0,
                            viewportWidth - 50,
                            viewportHeight - 50
                        ]);
                        
                        // –ï—Å–ª–∏ –ø–∞–Ω–µ–ª—å —É—à–ª–∞ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã —ç–∫—Ä–∞–Ω–∞
                        if (rect.left > viewportWidth || 
                            rect.right < 0 || 
                            rect.top > viewportHeight || 
                            rect.bottom < 0) {
                            resetPosition();
                        }
                    });
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –ø–æ—Å–ª–µ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    loadPosition();
                }
            });

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª –¥–ª—è –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö —Å–ª–æ–µ–≤
            map.addControl(new cadastralLayersControl());

            // –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã
                map.invalidateSize();
            
            // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            window.addEventListener('resize', function() {
                map.invalidateSize();
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
            let cadastralFeatures = {};

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            document.getElementById('cadastral-search-btn').addEventListener('click', searchCadastralObject);
            document.getElementById('cadastral-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchCadastralObject();
                }
            });

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
            function searchCadastralObject() {
                const cadastralNumber = document.getElementById('cadastral-input').value.trim();
                if (!cadastralNumber) {
                    alert('–í–≤–µ–¥–∏—Ç–µ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä');
                    return;
                }

                fetch(`/api/cadastral?cadastral_number=${encodeURIComponent(cadastralNumber)}`)
                    .then(response => {
                        if (!response.ok) {
                            if (response.status === 404) {
                                throw new Error('–û–±—ä–µ–∫—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                            }
                            throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω, —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º—Å—è –Ω–∞ –Ω–µ–º
                        if (cadastralFeatures[cadastralNumber]) {
                            // –ù–∞–π–¥–µ–º —Å–ª–æ–π —Å —ç—Ç–∏–º –æ–±—ä–µ–∫—Ç–æ–º
                            let foundLayer;
                            for (let layerName in cadastralLayers) {
                                cadastralLayers[layerName].eachLayer(layer => {
                                    if (layer.feature && layer.feature.properties.cad_num === cadastralNumber) {
                                        foundLayer = layer;
                                    }
                                });
                            }
                            
                            if (foundLayer) {
                                map.fitBounds(foundLayer.getBounds());
                                foundLayer.openPopup();
                                return;
                            }
                        }

                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞ –ø–æ —Å–µ–º–∞–Ω—Ç–∏–∫–µ –∏ –¥–∞–Ω–Ω—ã–º API
                        let isLandParcel;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å API
                        if (data.objectType === '–ó–µ–º–µ–ª—å–Ω—ã–π —É—á–∞—Å—Ç–æ–∫') {
                            isLandParcel = true;
                        } else if (data.objectType === '–û–±—ä–µ–∫—Ç –∫–∞–ø–∏—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞') {
                            isLandParcel = false;
            } else {
                            // –ï—Å–ª–∏ API –Ω–µ –¥–∞–ª —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–º—É –Ω–æ–º–µ—Ä—É
                            // –ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏ –æ–±—ã—á–Ω–æ –∏–º–µ—é—Ç —Ñ–æ—Ä–º–∞—Ç XX:XX:XXXXXX:XX
                            // –û–ö–° –∏–º–µ—é—Ç —Ñ–æ—Ä–º–∞—Ç XX:XX:XXXXXX:XX:XX –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –±—É–∫–≤—ã (–∑–¥–∞–Ω–∏–µ, —Å–æ–æ—Ä—É–∂–µ–Ω–∏–µ –∏ —Ç.–¥.)
                            const parts = cadastralNumber.split(':');
                            if (parts.length <= 4 && !cadastralNumber.match(/[–∞-—è–ê-–Ø]/)) {
                                isLandParcel = true;
                            } else {
                                isLandParcel = false;
                            }
                        }
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –Ω–∞ –∫–∞—Ä—Ç—É
                        addCadastralObject(data, isLandParcel);
                    })
                    .catch(error => {
                        alert(`–û—à–∏–±–∫–∞: ${error.message}`);
                    });
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç—É
            function addCadastralObject(data, isLandParcel) {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–ª–æ–π –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                const layerName = isLandParcel ? "–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏" : "–û–±—ä–µ–∫—Ç—ã –∫–∞–ø–∏—Ç–∞–ª—å–Ω–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞";
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∏–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞
                const style = {
                    color: isLandParcel ? '#000000' : '#8B4513', // –ß–µ—Ä–Ω—ã–π –¥–ª—è –ó–£, –∫–æ—Ä–∏—á–Ω–µ–≤—ã–π –¥–ª—è –û–ö–°
                    weight: 1.5,
                    opacity: 1, // –î–µ–ª–∞–µ–º –∫–æ–Ω—Ç—É—Ä—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–∏–¥–∏–º—ã–º–∏
                    fillOpacity: 0, // –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–±–∏—Ä–∞–µ–º –∑–∞–ª–∏–≤–∫—É –æ–±—ä–µ–∫—Ç–æ–≤
                    fillColor: isLandParcel ? '#000000' : '#8B4513', // –ß–µ—Ä–Ω–∞—è/–∫–æ—Ä–∏—á–Ω–µ–≤–∞—è –∑–∞–ª–∏–≤–∫–∞
                    dashArray: null,
                    lineCap: 'round',
                    lineJoin: 'round'
                };

                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–∏–ø–µ –æ–±—ä–µ–∫—Ç–∞ –≤ —Å–≤–æ–π—Å—Ç–≤–∞
                if (!data.properties) data.properties = {};
                data.properties.isLandParcel = isLandParcel;

                // –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ popup
                function generatePopupContent(feature) {
                    let content = `<div class="cadastral-popup-content">`;
                    content += `<div class="cadastral-popup-title">${feature.properties.cad_num || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</div>`;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–∞
                    const fields = [
                        { key: 'readable_address', label: '–ê–¥—Ä–µ—Å' },
                        { key: 'specified_area', label: '–ü–ª–æ—â–∞–¥—å —É—Ç–æ—á–Ω–µ–Ω–Ω–∞—è' },
                        { key: 'declared_area', label: '–ü–ª–æ—â–∞–¥—å –¥–µ–∫–ª–∞—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è' },
                        { key: 'cost_value', label: '–ö–∞–¥–∞—Å—Ç—Ä–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å' },
                        { key: 'land_record_type', label: '–¢–∏–ø –æ–±—ä–µ–∫—Ç–∞' },
                        { key: 'status', label: '–°—Ç–∞—Ç—É—Å' },
                        { key: 'category_type', label: '–ö–∞—Ç–µ–≥–æ—Ä–∏—è –∑–µ–º–µ–ª—å' },
                        { key: 'rights_reg', label: '–ü—Ä–∞–≤–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã' }
                    ];
                    
                    fields.forEach(field => {
                        if (feature.properties[field.key]) {
                            let value = feature.properties[field.key];
                            if (field.key === 'specified_area' || field.key === 'declared_area') {
                                value += ' –∫–≤.–º';
                            } else if (field.key === 'cost_value') {
                                value += ' —Ä—É–±.';
                            }
                            
                            content += `
                                <div class="cadastral-popup-row">
                                    <div class="cadastral-popup-label">${field.label}:</div>
                                    <div class="cadastral-popup-value">${value}</div>
                                </div>
                            `;
                        }
                    });
                    
                    content += '</div>';
                    return content;
                }

                // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Leaflet –¥–ª—è –Ω–∞—à–∏—Ö —Å–ª–æ–µ–≤
                const geoJsonOptions = {
                    style: style,
                    interactive: true,
                    bubblingMouseEvents: false,  // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—Å–ø–ª—ã—Ç–∏–µ —Å–æ–±—ã—Ç–∏–π –º—ã—à–∏
                    onEachFeature: function(feature, layer) {
                        // –î–æ–±–∞–≤–ª—è–µ–º tooltip
                        layer.bindTooltip(`–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä: ${feature.properties.cad_num || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}`, {
                            className: 'cadastral-tooltip',
                            direction: 'top',
                            permanent: false
                        });
                        
                        // –°–æ–∑–¥–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º popup
                        const popupContent = generatePopupContent(feature);
                        layer.bindPopup(popupContent, {
                            className: 'cadastral-popup',
                            maxWidth: 350
                        });
                        
                        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–ø–∏—Å—å —Å –Ω–æ–º–µ—Ä–æ–º —É—á–∞—Å—Ç–∫–∞ (–ø–æ—Å–ª–µ–¥–Ω—è—è —á–∞—Å—Ç—å –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞)
                        if (feature.properties.cad_num) {
                            const cadNumParts = feature.properties.cad_num.split(':');
                            const lastPart = ":" + cadNumParts[cadNumParts.length - 1];
                            
                            // –ü–æ–ª—É—á–∞–µ–º —Ü–µ–Ω—Ç—Ä –æ–±—ä–µ–∫—Ç–∞ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –º–µ—Ç–∫–∏
                            const bounds = layer.getBounds();
                            const center = bounds.getCenter();
                            
                            // –°–æ–∑–¥–∞–µ–º –∏–∫–æ–Ω–∫—É —Å —Ç–µ–∫—Å—Ç–æ–º
                            const labelIcon = L.divIcon({
                                html: lastPart,
                                className: 'cadastral-label',
                                iconSize: null  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä
                            });
                            
                            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä —Å –º–µ—Ç–∫–æ–π –Ω–∞ —Ü–µ–Ω—Ç—Ä –æ–±—ä–µ–∫—Ç–∞
                            L.marker(center, { 
                                icon: labelIcon,
                                interactive: false,  // –î–µ–ª–∞–µ–º –º–µ—Ç–∫—É –Ω–µ–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π
                                zIndexOffset: 1000   // –ü–æ–¥–Ω–∏–º–∞–µ–º –º–µ—Ç–∫—É –Ω–∞–¥ –ø–æ–ª–∏–≥–æ–Ω–æ–º
                            }).addTo(cadastralLayers[layerName]);
                        }
                        
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä –≤ feature
                        cadastralFeatures[feature.properties.cad_num] = feature;
                    }
                };
                
                // –°–æ–∑–¥–∞–µ–º GeoJSON —Å–ª–æ–π –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–ª–æ—è
                const layer = L.geoJSON(data, geoJsonOptions);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π –Ω–∞ –∫–∞—Ä—Ç—É –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                cadastralLayers[layerName].addLayer(layer);
                
                // –î—É–±–ª–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –Ω–∞ –æ–±—â–∏–π —Å–ª–æ–π –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ —Å—Ç–∏–ª—å –∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π
                cadastralLayers["–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã"].addLayer(
                    L.geoJSON(data, geoJsonOptions)
                );
                
                // –ë–æ–ª–µ–µ –ø–ª–∞–≤–Ω–æ–µ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏
                map.fitBounds(layer.getBounds(), {
                    padding: [50, 50],
                    maxZoom: 18,
                    animate: true,
                    duration: 0.5
                });
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º popup —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
                setTimeout(() => {
                    layer.eachLayer(l => l.openPopup());
                }, 500);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html> 